{% load comments %}
<td id="id_case_text_{{ forloop.counter }}" colspan="12">
	<form class="update_form" method="POST">
		<table class="case_detail">
			<tr>
				<td valign="top">
					<h1>It's review!</h1>
					<h4>Setup:</h4>
					<div class="content">{{ test_case_text.setup|safe }}</div>
				</td>
				<td class="" valign="top">
					<h4>Breakdown:</h4>
					<div class="content">{{ test_case_text.breakdown|safe }}</div>
				</td>
				<td valign="top" rowspan="2" width="200">
					<h4><span class="title strong">Attachment:</span></h4>
					<ul class="ul-no-format">
						{% for attachment_file in test_case.attachment.all %}
						<li>
							<a href="{% url tcms.core.files.check_file attachment_file.attachment_id %}">
								{{ attachment_file.file_name }}
							</a>
						</li>
						{% empty %}
						<li class="grey">No attachment found</li>
						{% endfor %}
					</ul>
					<h4><span class="title strong">Component:</span></h4>
					<ul class="ul-no-format">
						{% for component in test_case.component.all %}
						<li id="display_component" >{{ component.name }}</li>
						{% empty %}
						<li class="grey">No component found</li>
						{% endfor %}
					</ul>
					<h4><span class="title strong">Tag:</span></h4>
					<ul class="ul-no-format">
						{% for tag in test_case.tag.all %}
						<li>{{ tag }}</li>
						{% empty %}
						<li class="grey">No tag found</li>
						{% endfor %}
					</ul>
					<h4><span class="title strong">bug:</span></h4>
					<ul class="ul-no-format">
						{% for bug in bugs %}
						<li>
							<a href="{{ bug.get_absolute_url }}">{{ bug }}</a>
							{% if bug.case_run_id %}
							<span class="grey"> - From Run</span>
							<a href="{% url tcms.testruns.views.get bug.case_run.run_id %}">{{ bug.case_run.run_id }}</a>
							{% endif %}
						</li>
						{% empty %}
						<li class="grey">No bug found</li>
						{% endfor %}
					</ul>
				</td>
			</tr>
			<tr>
				<td class="" valign="top">
					<h4>Actions:</h4>
					<div class="content">{{ test_case_text.action|safe }}</div>
				</td>
				<td class="" valign="top">
					<h4>Expected Results:</h4>
					<div class="content">{{ test_case_text.effect|safe }}</div>
				</td>
			</tr>
			<tr>
				<td colspan="3" style="border:none; background:none">
					{% get_comment_list for test_case as case_run_comments %}
					<h4>Comments:</h4>
					<ul class="comment ul-no-format">
						{% for comment in case_run_comments %}
						<li>
							<span class="strong">{{ comment.user.email }}</span>
							<span class="grey">{{ comment.submit_date }}</span><br/>
							{{ comment.comment|linebreaksbr }} 
						</li>
						{% endfor %}
					</ul>
				</td>
			</tr>
			<tr>
				<td colspan="3">
					{% get_comment_form for test_case as comment_form %}
					{{ comment_form.as_p }}
					{% comment %}
					{# Disable the change case status buttons temporary #}
					<input type="hidden" name="template_type" value="review_case">
					<input type="hidden" name="value" value="" />
					{% for status in test_case_status %}
					<input type="submit" value="{{ status }}" {% ifequal status test_case.case_status %}disabled="True"{% endifequal %} onclick="this.form.value='{{ tcs.pk }}'" />
					{% endfor %}
					{% endcomment %}
					<input type="submit" class="submit-post" value="Submit">
				</td>
			</tr>
			<tr>
				<td colspan="3" class="row">
					<h4>Change Log</h4>
					<ul>
						{% for log in test_case.log %}
						<li>[{{ log.date }}] - [{{ log.who }}] - {{ log.action }}</li>
						{% empty %}
						<li class="grey">No log recorded.</li>
						{% endfor %}
					</ul>
				</td>
			</tr>
		</table>
	</form>
</td>
