{% extends "tcms_base.html" %}

{% load comments %}

{% block subtitle %}Reporting{% endblock %}

{% block custom_stylesheet %}
<link rel="stylesheet" type="text/css" href="{{ MEDIA_URL }}/style/print.css" media="print" />
{% endblock %}

{% block custom_javascript %}
<script type="text/javascript" src="{{ MEDIA_URL }}/js/lib/tablesort/fastinit.js"></script>
<script type="text/javascript" src="{{ MEDIA_URL }}/js/lib/tablesort/tablesort.js"></script>
<script type="text/javascript" src="{{ MEDIA_URL }}/js/report.js"></script>
<script type="text/javascript">
Nitrate.Utils.after_page_load(Nitrate.Report.CustomDetails.on_load);
</script>
{% endblock %}

{% block contents %}
<div id="content">
	<div class="crumble"><a href="{% url tcms.core.views.index %}">Home</a>>>Reporting</div>
	<div class="report_title_bg">
		<form action="{% url tcms.report.views.custom_details %}">
			{{ form.product.label }}: {{ form.product }}<br />
			{{ form.build_run__product_version.label }}: {{ form.build_run__product_version }}<br />
			{{ form.pk__in.label }}: {{ form.pk__in }}<br />
			<input type="submit" />
		</form>
	</div>
	
	<table class="table_style" cellpadding="0" cellspacing="0" border="0" width="100%" id="id_table_cases" >
		<thead>
			<tr>
				<th align="left" class="sortcol sortdesc" >Plan name</th>
				<th align="left" class="sortcol">Run name</th>
				<th align="left" class="sortcol" width="40">Idle</th>
				<th align="left" class="sortcol" width="70">Running</th>
				<th align="left" class="sortcol" width="60">Paused</th>
				<th align="left" class="sortcol" width="50">Passed</th>
				<th align="left" class="sortcol" width="50">Failed</th>
				<th align="left" class="sortcol" width="60">Blocked</th>
				<th align="left" class="sortcol" width="50">Error</th>
				<th align="left" class="sortcol" width="60">Waived</th>
				<th align="left" class="sortcol" width="50">Total</th>
			</tr>
		</thead>
		<tbody>
			{% for test_plan in test_plans %}
			{% for test_run in test_plan.runs %}
			<tr>
				{% if forloop.first %}
				<td rowspan="{{ test_plan.runs|length }}"><a href="{{ test_plan.get_url_path }}">[{{ test_plan.pk}}] {{ test_plan.name }}</a></td>
				{% endif %}
				<td valign="top"><a href="{{ test_run.get_url_path }}">[{{ test_run.pk }}] {{ test_run.summary }}</a></td>
				<td valign="top">
                {% if test_run.IDLE %}
                <a href="{% url tcms.testruns.views.execute test_run.pk %}?case_run_status=idel">{{ test_run.IDLE }}</a>
                {% else %}
                {% endif %}
                </td>
				<td valign="top">
                {% if test_run.RUNNING %}
                <a href="{% url tcms.testruns.views.execute test_run.pk %}?case_run_status=running">{{ test_run.RUNNING }}</a>
                {% else %}
                {% endif %}
                </td>
				<td valign="top">
                {% if test_run.PAUSED %}
                <a href="{% url tcms.testruns.views.execute test_run.pk %}?case_run_status=paused">{{ test_run.PAUSED }}</a>
                {% else %}
                {% endif %}
                </td>
				<td valign="top">
                {% if test_run.PASSED %}
                <a href="{% url tcms.testruns.views.execute test_run.pk %}?case_run_status=passed">{{ test_run.PASSED }}</a>
                {% else %}
                {% endif %}
                </td>
				<td valign="top">
                {% if test_run.FAILED %}
                <a href="{% url tcms.testruns.views.execute test_run.pk %}?case_run_status=failed">{{ test_run.FAILED }}</a>
                {% else %}
                {% endif%}
                </td>
				<td valign="top">
                {% if test_run.BLOCKED %}
                <a href="{% url tcms.testruns.views.execute test_run.pk %}?case_run_status=blocked">{{ test_run.BLOCKED }}</a>
                {% else %}
                {% endif%}
                </td>
				<td valign="top">
                {% if test_run.ERROR %}
                <a href="{% url tcms.testruns.views.execute test_run.pk %}?case_run_status=error">{{ test_run.ERROR }}</a>
                {% else %}
                {% endif %}
                </td>
				<td valign="top">
                {% if test_run.WAIVED %}
                <a href="{% url tcms.testruns.views.execute test_run.pk %}?case_run_status=waived">{{ test_run.WAIVED }}</a>
                {% else %}
                {% endif %}
                
                </td>
				<td valign="top">
                {% if test_run.case_run.count %}
                <a href="{% url tcms.testruns.views.execute test_run.pk %}">{{ test_run.case_run.count }}</a>
                {% else %}
                {% endif %}
                </td>
			</tr>
			{% endfor %}
			{% endfor %}
		</tbody>
	</table>

	<div class="failed_caserun">
		All Failed Case-Run List
	</div>
	<table class="table_noborder" cellpadding="0" cellspacing="0" border="0" width="100%" id="id_table_cases" >
		<tr>
			<th align="left" class="sortcol sortdesc" width="60" >Case ID</th>
            <th align="left" class="sortcol" width="100">Case Run ID</th>
			<th align="left" class="sortcol">Case name</th>
			<th align="left" class="sortcol" width="150">Category</th>
			<th align="left" class="sortcol" width="120">Tester</th>
			<th align="left" class="sortcol" width="200">The Lastest Execute Time</th>
		</tr>
		{% for test_case_run in test_case_runs %}
		{% ifequal test_case_run.case_run_status.name 'FAILED' %}
		<tr>
			<td valign="top" ><a href="#">{{ test_case_run.case.pk }}</a></td>
            <td valign="top"><a href="{% url tcms.testruns.views.execute test_case_run.run_id %}#caserun_{{ test_case_run.pk }}">{{ test_case_run.pk }}</a></td>
			<td valign="top" ><a href="#">{{ test_case_run.case.summary }}</a></td>
			<td valign="top" >{{ test_case_run.case.category }}</td>
			<td valign="top" >{{ test_case_run.tested_by }}</td>
			<td valign="top" >{{ test_case_run.close_date }}</td>
		</tr>
		{% get_comment_list for test_case_run as comments %}
		
		{% if comments %}
		<tr>
			<td colspan="5">Comments:</td>
		</tr>
		{% for comment in comments %}
		<tr class="border-bottom">
			<td valign="top" colspan="5">{{ comment.comment|linebreaksbr }}<span class="grey">[{{ comment.user }} {{ comment.submit_date }}]</span></td>
		</tr>
		{% endfor %}
		{% endif %}
		
		{% if test_case_run.bug.count %}
		<tr>
			<td colspan="5">Bugs:</td>
		</tr>
		{% endif %}
		
		{% for bug in test_case_run.bug.all %}
		<tr class="border-bottom">
			<td valign="top" colspan="5"><a href="{{ bug.get_url }}">{{ get_url }}</a> </td>
		</tr>
		{% endfor %}
		
		{% endifequal %}
		{% endfor %}
	</table>

	<div class="blocked_caserun">
		All Blocked Case-Run List
	</div>
	<table class="table_noborder" cellpadding="0" cellspacing="0" border="0" width="100%" id="id_table_cases" >
		<tr>
			<th align="left" class="sortcol sortdesc" width="60">Case ID</th>
			<th align="left" class="sortcol sortdesc" width="100">Case Run ID</th>
			<th align="left" class="sortcol">Case name</th>
			<th align="left" class="sortcol" width="150">Category</th>
			<th align="left" class="sortcol" width="120">Tester</th>
			<th align="left" class="sortcol" width="200">The Lastest Execute Time</th>
		</tr>
		{% for test_case_run in test_case_runs %}
		{% ifequal test_case_run.case_run_status.name 'BLOCKED' %}
		<tr>
			<td valign="top"><a href="{{ test_case_run.case.get_url_path }}">{{ test_case_run.case.pk }}</a></td>
			<td valign="top"><a href="{% url tcms.testruns.views.execute test_case_run.run_id %}#caserun_{{ test_case_run.pk }}">{{ test_case_run.pk }}</td>
			<td valign="top"><a href="{{ test_case_run.case.get_url_path }}">{{ test_case_run.case.summary }}</a></td>
			<td valign="top">{{ test_case_run.case.category }}</td>
			<td valign="top">{{ test_case_run.tested_by }}</td>
			<td valign="top">{{ test_case_run.close_date }}</td>
		</tr>
		{% get_comment_list for test_case_run as comments %}
		
		{% if comments %}
		<tr>
			<td colspan="5">Comments:</td>
		</tr>
		{% for comment in comments %}
		<tr class="border-bottom">
			<td valign="top" colspan="5">{{ comment.comment|linebreaksbr }}<span class="grey">[{{ comment.user }} {{ comment.submit_date }}]</span></td>
		</tr>
		{% endfor %}
		{% endif %}
		
		{% if test_case_run.bug.count %}
		<tr>
			<td colspan="5">Bugs:</td>
		</tr>
		{% endif %}
		
		{% for bug in test_case_run.bug.all %}
		<tr class="border-bottom">
			<td valign="top" colspan="5"><a href="{{ bug.get_url }}">{{ get_url }}</a> </td>
		</tr>
		{% endfor %}
		
		{% endifequal %}
		{% endfor %}
	</table>
</div>
{% endblock %}
