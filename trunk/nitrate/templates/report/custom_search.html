{% extends "tcms_base.html" %}

{% load report_tags %}

{% block subtitle %}Reporting{% endblock %}

{% block custom_stylesheet %}
<link rel="stylesheet" type="text/css" href="{{ MEDIA_URL }}/style/print.css" media="print" />
{% endblock %}

{% block custom_javascript %}
<script type="text/javascript" src="{{ MEDIA_URL }}/js/lib/tablekit/fastinit.js"></script>
<script type="text/javascript" src="{{ MEDIA_URL }}/js/lib/tablekit/tablekit.js"></script>
<script type="text/javascript" src="{{ MEDIA_URL }}/js/report.js"></script>
<script type="text/javascript">
Nitrate.Utils.after_page_load(Nitrate.Report.CustomSearch.on_load);
</script>
{% endblock %}

{% block contents %}
<div id="content">
	<div class="sprites crumble"><a href="{% url tcms.core.views.index %}">Home</a> >> Custom Reporting</div>
	<div class="itemSearch">
		<h2>Report Options</h2>
		<form id="id_form_search" action="{% url tcms.report.views.custom_search %}">
			{% include "report/form/search.html" %}
			<div class="bottom">
				<input type="submit" name="a" value="Search" title="Create report" />
				{# <input type="reset" alue="Save Query" name="" title="Save Query" /> #}
			</div>
		</form>
	</div>
	{% if builds %}
    <div class="report_bar">
		<b>{{ builds|length }} builds are selected</b>
		<div class='coverage_report'>Plan<span class="red">{{ total_plans_count }}</span> Run<span class="red">{{ total_runs_count }}</span>Manual Cases<span class="red">{{manual_count|percentage:total_count}}({{manual_count}}/{{total_count}})</span>Automated Cases<span class="red">{{auto_count|percentage:total_count}}({{auto_count}}/{{total_count}})</span>Manual/Automated<span class="red">{{both_count|percentage:total_count}}({{both_count}}/{{total_count}})</span></div>
	</div>
	<table class="list border-bottom" cellpadding="0" cellspacing="0" border="0"  id="id_table_report" >
		<thead>
			<tr>
				<th align="left" class="text">Build</th>
				<th align="left" class="number" width="100">Plan</th>
				<th align="left" class="number" width="100">Run</th>
				<th align="left" class="number" width="100">Case-Run</th>
				<th align="left" class="number" width="150">Passed case-run</th>
				<th align="left" class="number" width="150">Failed case-run</th>
			</tr>
		</thead>
		<tbody>
			{% for build in builds %}
			<tr class="{% cycle 'even' 'odd' %}">
				<td>
					<input type="hidden" name="build_id" value="{{ build.pk }}" />
					{% if build.plans_count %}<a class="build_link"  href="{% url tcms.report.views.custom_details %}" >{% endif %}{{ build }}</a>
				</td>
				<td valign="top">
                {% if build.plans_count %}
                <a href="{% url tcms.testplans.views.all %}?product={{ build.product.pk }}&build={{ build.pk }}&default_product_version={{ REQUEST_CONTENTS.build_run__product_version }}">{{ build.plans_count }}</a>
                {% else %}
                0
                {% endif %}
                
                </td>
				<td valign="top">
                {% if build.runs_count %}
                <a href="{% url tcms.testruns.views.all %}?product={{ build.product.pk }}&build={{ build.pk }}&product_version={{ REQUEST_CONTENTS.build_run__product_version }}">{{ build.runs_count }}</a>
                {% else %}
                {{ build.runs_count }}
                {% endif %}
                </td>
				<td valign="top">{{ build.case_runs_count }}</td>
				<td valign="top">
				<div class="progress-bar">
					<div class="progress-inner" style="width:auto;	margin-right:-50px;text-align:cente">
						<div class="progress-passed" style="width:{{ build.get_case_runs_passed_percent|floatformat:0 }}px;">
							&nbsp;
						</div>
					</div>
					<div class="percent">{{ build.get_case_runs_passed_percent|floatformat }}% ({{ build.case_runs_passed_count }})</div>
				</div>
				
				</td>
				<td valign="top">
				<div class="progress-bar">
					<div class="progress-inner" style="width:auto;	margin-right:-50px;text-align:cente">
						<div class="progress-failed" style="width:{{ build.case_runs_failed_percent|floatformat:0 }}px;">
							&nbsp;
						</div>
					</div>
					<div class="percent">{{ build.case_runs_failed_percent|floatformat }}% ({{ build.case_runs_failed_count }})</div>
				</div>
				
				</td>
			</tr>
			{% endfor %}
            {% comment %}
			<tr>
				<td>Total ({{ builds|length }})</td>
				<td valign="top">20</td>
				<td valign="top">40</td>
				<td valign="top">150</td>
				<td valign="top">99</td>
				<td valign="top">52</td>
			</tr>
            {% endcomment %}
		</tbody>
	</table>
	{% else %}
	<div class="report_bar"><span>No builds found with search condition.</span></div>
	{% endif %}
</div>
{% endblock %}
