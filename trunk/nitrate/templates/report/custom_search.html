{% extends "tcms_base.html" %}

{% block subtitle %}Reporting{% endblock %}

{% block custom_stylesheet %}
<link rel="stylesheet" type="text/css" href="{{ MEDIA_URL }}/style/print.css" media="print" />
{% endblock %}

{% block custom_javascript %}
<script type="text/javascript" src="{{ MEDIA_URL }}/js/lib/tablekit/fastinit.js"></script>
<script type="text/javascript" src="{{ MEDIA_URL }}/js/lib/tablekit/tablekit.js"></script>
<script type="text/javascript" src="{{ MEDIA_URL }}/js/report.js"></script>
<script type="text/javascript">
Nitrate.Utils.after_page_load(Nitrate.Report.CustomSearch.on_load);
</script>
{% endblock %}

{% block contents %}
<div id="content">
	<div class="sprites crumble"><a href="{% url tcms.core.views.index %}">Home</a> >> Customization Reporting</div>
	
	<div class="report_title_bg">Product -- show report what you want to see</div>
	<form id="id_form_search" action="{% url tcms.report.views.custom_search %}">
		{% include "report/form/search.html" %}
		<div class="button_box" >
			<input type="submit" name="a" value="search" title="Create report" />
			{# <input type="reset" alue="Save Query" name="" title="Save Query" /> #}
		</div>
	</form>
	{% if builds %}
    <div class="report_bar"><span>{{ builds|length }} builds are selected</span></div>
	<table class="list border-bottom" cellpadding="0" cellspacing="0" border="0"  id="id_table_report" >
		<thead>
			<tr>
				<th align="left" class="sortcol">Build</th>
				<th align="left" class="sortcol">Plan</th>
				<th align="left" class="sortcol">Run</th>
				<th align="left" class="sortcol">Case-Run</th>
				<th align="left" class="sortcol">Passed case-run</th>
				<th align="left" class="sortcol">Failed case-run</th>
			</tr>
		</thead>
		<tbody>
			{% for build in builds %}
			<tr class="{% cycle 'even' 'odd' %}">
				<td>
                	{% if build.plans_count %}
					<input type="hidden" name="build_id" value="{{ build.pk }}" />
					<a class="build_link" href="{% url tcms.report.views.custom_details %}">{{ build }}</a>
                    {% else %}
                    {{ build }}
                    {% endif %}
				</td>
				<td valign="top">
                {% if build.plans_count %}
                <a href="{% url tcms.testplans.views.all %}?product={{ build.product.pk }}&build={{ build.pk }}&default_product_version={{ REQUEST_CONTENTS.build_run__product_version }}">{{ build.plans_count }}</a>
                {% else %}
                0
                {% endif %}
                
                </td>
				<td valign="top">
                {% if build.runs_count %}
                <a href="{% url tcms.testruns.views.all %}?product={{ build.product.pk }}&build={{ build.pk }}&product_version={{ REQUEST_CONTENTS.build_run__product_version }}">{{ build.runs_count }}</a>
                {% else %}
                {{ build.runs_count }}
                {% endif %}
                </td>
				<td valign="top">{{ build.case_runs_count }}</td>
				<td valign="top">
				<div class="progress-bar">
					<div class="progress-inner" style="width:auto;	margin-right:-50px;text-align:cente">
						<div class="progress-passed" style="width:{{ build.case_runs_passed_percent|floatformat:0 }}px;">
							&nbsp;
						</div>
					</div>
					<div class="percent">{{ build.case_runs_passed_percent|floatformat }}% ({{ build.case_runs_passed_count }})</div>
				</div>
				
				</td>
				<td valign="top">
				<div class="progress-bar">
					<div class="progress-inner" style="width:auto;	margin-right:-50px;text-align:cente">
						<div class="progress-failed" style="width:{{ build.case_runs_failed_percent|floatformat:0 }}px;">
							&nbsp;
						</div>
					</div>
					<div class="percent">{{ build.case_runs_failed_percent|floatformat }}% ({{ build.case_runs_failed_count }})</div>
				</div>
				
				</td>
			</tr>
			{% endfor %}
            {% comment %}
			<tr>
				<td>Total ({{ builds|length }})</td>
				<td valign="top">20</td>
				<td valign="top">40</td>
				<td valign="top">150</td>
				<td valign="top">99</td>
				<td valign="top">52</td>
			</tr>
            {% endcomment %}
		</tbody>
	</table>
	{% else %}
	<div class="report_bar"><span>No builds found with search condition.</span></div>
	{% endif %}
</div>
{% endblock %}
